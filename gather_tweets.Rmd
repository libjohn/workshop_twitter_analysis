---
title: "gather with rtweet"
output: html_notebook
---


```{r}
library(tidyverse)
library(rtweet)
```

- https://docs.ropensci.org/rtweet/
- [Introduction to gathering tweets with rwteet](https://docs.ropensci.org/rtweet/articles/intro.html)


## Search tweets

`search_tweets()` - search a keyword(s) or hashtag

I recommend limiting the number of tweets returned (`n = 1000`) for this training.  Otherwise you'll probably hit a rate limit.

```{r}
bts <- search_tweets("#BTS", n = 5000, include_rts = FALSE)

bts_dynamite <- search_tweets("#BTS dynamite", n = 5000, include_rts = FALSE)
```

```{r}
bts
bts_dynamite
```

## get friends

Find all the accounts a user follows

```{r}
john_little <-  get_friends("john_little")
```

```{r}
john_little
```

Use the retreived `user_id` to get more information about those accounts.

```{r}
john_little_data <- lookup_users(john_little$user_id)
```

```{r}
john_little_data
```

## get followers

Who is following me?  `get_followers()`

```{r}
jrl_flw <- get_followers("john_little")
```


```{r}
jrl_flw_data <- lookup_users(jrl_flw$user_id)
```


```{r}
jrl_flw_data 
```

## timelines

Get the most recent tweets from an account

```{r}
rg_tmls <- get_timelines("RhiannonGiddens", n = 3200)
```


min(created_at)     | max(created_at)
------------------- | ---
2015-04-21 13:59:55 |	2020-10-27 20:49:18	

```{r warning=FALSE}
rg_tmls %>% 
  dplyr::filter(created_at > "2016-01-01") %>%  
  dplyr::group_by(screen_name) %>%
  ts_plot("weeks", trim = 1L) +
  ggplot2::geom_point() +
  geom_smooth(se = FALSE, color = "cadetblue") +
  colorblindr::scale_color_OkabeIto() +
  hrbrthemes::theme_ipsum(grid = "Y") +
  ggplot2::theme(
    legend.title = ggplot2::element_blank(),
    legend.position = "bottom", 
    plot.title = ggplot2::element_text(face = "bold")
    ) +
    ggplot2::labs(
    x = NULL, y = NULL,
    title = "Frequency of Twitter statuses",
    subtitle = "Twitter status (tweet) counts aggregated by week from Jan. 2016",
    caption = "Source: Data collected from Twitter's REST API via rtweet"
  )


```

## get_favorites

Get the most recent favorites from a user

```{r}
rg_faves <- get_favorites("RhiannonGiddens", n = 3000)
```

```{r}
rg_faves
```

## Profiles

Search a users' profiles


```{r}
gullah <- search_users("#gullah", n = 1000)
```


```{r}
gullah
```

## get trends

What is trendingin a specific location?

```{r}
# sf <- get_trends("san franciso")
# durham <- get_trends(lat = 36.0, lng = -78.9)
greensboro <- get_trends("greensboro")
```

```{r}
greensboro
```

## Location information

Using some additional R libraries, the location information can be geocoded and then visualize.

### First, geocode 

Use the [tidygeocoder](https://jessecambon.github.io/tidygeocoder) package.  

```{r}
# glimpse(rg_tmls)
rg_places <- rg_tmls %>% 
  drop_na(place_name) %>% 
  select(place_name:bbox_coords) %>% 
  distinct() %>% 
  mutate(addr = glue::glue("{place_full_name}, {country}")) %>% 
  tidygeocoder::geocode(addr, method = "osm")

rg_places
```

### Visuzlize 

You can create maps in R.  Below is one of the easiest, especially if you know [ggplot2](https://ggplot2.tidyverse.org)

```{r}
rg_places %>% 
  distinct() %>% 
  drop_na(lat) %>% 
  ggplot(aes(long, lat), color="grey99") +
  borders("world") + 
  geom_point(color = "goldenrod") + 
  ggrepel::geom_label_repel(aes(label = place_full_name), 
                            segment.color = "goldenrod", segment.size = 1,
                            color = "navy") + 
  theme_void()
```

### Second location example

Very similar to above.  For accounts with "#gullah" in their profile, and that have location information listed, then geocode the location .....

```{r}
gullah_places <- gullah %>% 
  drop_na(place_name) %>% 
  select(place_name:bbox_coords) %>% 
  filter(country_code == "US")  %>%
  distinct() %>% 
  mutate(addr = glue::glue("{place_full_name}, {country}")) %>% 
  tidygeocoder::geocode(addr, method = "osm")

gullah_places
```

And visualize on a US map of the _lower 48_ states.

You can learn more about basic R mapping from our workshop on [mapping with R](https://rfun.library.duke.edu/portfolio/mapping_workshop/)


```{r}
gullah_places %>% 
  distinct() %>% 
  drop_na(lat) %>% 
  ggplot(aes(long, lat), color="grey99") +
  borders("state") + 
  geom_point(color = "goldenrod") + 
  ggrepel::geom_label_repel(aes(label = place_full_name), 
                            segment.color = "goldenrod", segment.size = 1,
                            color = "navy") + 
  theme_void()
```


